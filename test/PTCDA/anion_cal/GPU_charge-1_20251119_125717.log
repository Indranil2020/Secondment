
Parallel computation enabled: 12 threads (auto-detected)

======================================================================
MOLECULE SETUP
======================================================================
Loading molecule from: H2O.xyz
Basis set: 6-31g
Charge: -1
Number of atoms: 3
Number of electrons: 11
Number of basis functions: 13
Molecular charge: -1
Spin multiplicity (2S+1): 2
Number of unpaired electrons (2S): 1
System type: Open-shell (doublet)
DFT method: UKS (GPU-accelerated)

======================================================================
GROUND STATE DFT CALCULATION
======================================================================
XC functional: b3lyp
Basis set: 6-31g
Method: UKS (GPU-accelerated)
✓ SCF converged
Ground state energy: -76.222245 a.u.

======================================================================
GROUND STATE DENSITY AND POTENTIAL
======================================================================
System type: UKS (open-shell)
  Alpha electrons: 6.90
  Beta electrons: 3.36
Total electrons: 10.27
Molecular charge: -1
Expected electrons: 11

Generating ground state charge density...
  ✓ Ground state density: output_gpu_charge-1/ground_state_density.cube
    Use this to visualize total electron distribution

Generating electrostatic potential (ESP)...
  ✓ Electrostatic potential: output_gpu_charge-1/electrostatic_potential.cube
    Use this to identify:
      - Nucleophilic sites (negative ESP, red)
      - Electrophilic sites (positive ESP, blue)
      - Reaction sites and molecular recognition

Generating deformation density...
  Deformation density = SCF density - Promolecule density
  Shows charge redistribution due to chemical bonding
  System: UKS (open-shell)
  Promolecule alpha electrons: 3.62
  Promolecule beta electrons: 3.62
  Promolecule total electrons: 7.24
  Deformation integral: 3.026764 (should be ~0)
  Max |deformation|: 1.456302
  ✓ SCF density: output_gpu_charge-1/scf_density.cube
  ✓ Promolecule density: output_gpu_charge-1/promolecule_density.cube
  ✓ Deformation density: output_gpu_charge-1/deformation_density.cube
  Interpretation:
    - Positive regions (red): electron accumulation (bonding)
    - Negative regions (blue): electron depletion (atomic cores)
======================================================================

======================================================================
TDDFT CALCULATION
======================================================================
Note: TDDFT inherits XC functional (b3lyp) and basis set (6-31g) from ground state
TDDFT method: TDDFT (UKS-based, GPU-accelerated)
Using full TDDFT - more accurate but slower
Calculating 10 excited states...
✓ TDDFT converged (all states)

======================================================================
EXCITED STATE ENERGIES
======================================================================
State 1: 0.103705 a.u. = 2.822 eV
State 2: 0.254670 a.u. = 6.930 eV
State 3: 0.291568 a.u. = 7.934 eV
State 4: 0.333405 a.u. = 9.072 eV
State 5: 0.334241 a.u. = 9.095 eV
State 6: 0.369738 a.u. = 10.061 eV
State 7: 0.427790 a.u. = 11.641 eV
State 8: 0.481358 a.u. = 13.098 eV
State 9: 0.501984 a.u. = 13.659 eV
State 10: 0.611875 a.u. = 16.650 eV
======================================================================

======================================================================
TRANSITION DIPOLE MOMENTS
======================================================================

Transition dipole moments (a.u.):
State    μ_x          μ_y          μ_z          |μ|          f           
----------------------------------------------------------------------
1          -0.000000   -1.402104    0.000000    1.402104    0.135915
2          -0.200004    0.000000    0.000000    0.200004    0.006791
3          -0.000000    0.000000    0.000000    0.000000    0.000000
4           0.000000    0.000000    0.000000    0.000000    0.000000
5          -0.000000   -0.000000   -0.445490    0.445490    0.044223
6           0.000000   -0.143132    0.000000    0.143132    0.005050
7          -0.000000   -0.626007    0.000000    0.626007    0.111763
8          -0.000000   -0.842360    0.000000    0.842360    0.227705
9           0.000000   -0.000000   -0.120532    0.120532    0.004862
10          0.000000   -0.000000    0.679416    0.679416    0.188297
======================================================================

======================================================================
NATURAL TRANSITION ORBITAL ANALYSIS
======================================================================

State 1 (2.822 eV):
  Alpha NTO orbitals saved to: output_gpu_charge-1/nto_state_1_alpha.molden
  Beta NTO orbitals saved to: output_gpu_charge-1/nto_state_1_beta.molden

State 2 (6.930 eV):
  Alpha NTO orbitals saved to: output_gpu_charge-1/nto_state_2_alpha.molden
  Beta NTO orbitals saved to: output_gpu_charge-1/nto_state_2_beta.molden

State 3 (7.934 eV):
  Alpha NTO orbitals saved to: output_gpu_charge-1/nto_state_3_alpha.molden
  Beta NTO orbitals saved to: output_gpu_charge-1/nto_state_3_beta.molden
======================================================================

======================================================================
TRANSITION CONTRIBUTION ANALYSIS
======================================================================
Analyzing orbital pair contributions to excited states...

======================================================================
STATE 1: 2.8219 eV
======================================================================
Rank   Transition           Weight       Percentage   Cumulative  
----------------------------------------------------------------------
1      LUMO+3 → LUMO+4      1.000000     100.00      % 100.00      %
----------------------------------------------------------------------
Total weight analyzed: 0.815057

======================================================================
STATE 2: 6.9298 eV
======================================================================
Rank   Transition           Weight       Percentage   Cumulative  
----------------------------------------------------------------------
----------------------------------------------------------------------
Total weight analyzed: 0.000000

======================================================================
STATE 3: 7.9339 eV
======================================================================
Rank   Transition           Weight       Percentage   Cumulative  
----------------------------------------------------------------------
1      LUMO+2 → LUMO+4      1.000000     100.00      % 100.00      %
----------------------------------------------------------------------
Total weight analyzed: 0.955189

✓ Contribution tables saved to: output_gpu_charge-1/contribution_tables.txt

======================================================================
GENERATING ORBITAL PAIR TRANSITION DENSITY CUBE FILES
======================================================================
Note: Cube files will be generated after grid parameters are calculated
      (see CUBE FILE GENERATION section below)
======================================================================

======================================================================
GRID PARAMETERS
======================================================================
Using box dimensions with margin: 4.0 Å
Grid spacing: 0.2 Å
Calculated grid resolution: 40 × 48 × 43
Total grid points: 82,560
Box size: [8.         9.5143994  8.58649977] Å
======================================================================

======================================================================
GENERATING HOMO/LUMO CUBE FILES
======================================================================
Note: Using alpha orbitals for HOMO/LUMO (open-shell system)
HOMO index: 5
LUMO index: 6
HOMO energy: 7.371 eV
LUMO energy: 11.166 eV
HOMO-LUMO gap: 3.796 eV

  ✓ HOMO orbital: output_gpu_charge-1/HOMO.cube
  ✓ LUMO orbital: output_gpu_charge-1/LUMO.cube
  ✓ HOMO-1 orbital: output_gpu_charge-1/HOMO-1.cube
  ✓ LUMO+1 orbital: output_gpu_charge-1/LUMO+1.cube

Verification tip:
For the first excited state (S1), check if the transition density
resembles a HOMO→LUMO transition by comparing:
  - transition_density_state1.cube
  - HOMO.cube (electron depletion)
  - LUMO.cube (electron accumulation)

----------------------------------------------------------------------
ANALYTICAL VERIFICATION: HOMO→LUMO Transition Density
----------------------------------------------------------------------
  ✓ Analytical HOMO→LUMO transition: output_gpu_charge-1/transition_HOMO_LUMO_analytical.cube

To verify S1 is a HOMO→LUMO transition, compare:
  1. output_gpu_charge-1/transition_density_state1.cube
  2. output_gpu_charge-1/transition_HOMO_LUMO_analytical.cube

They should be very similar if S1 is dominated by HOMO→LUMO excitation.
You can calculate the overlap/similarity in VMD or by visual inspection.
======================================================================

======================================================================
GENERATING EXCITED STATE CUBE FILES
======================================================================
Generating cube files for states: [1, 2, 3]
Grid resolution: 40 × 48 × 43

State 1: 2.822 eV
  ✓ Transition density: output_gpu_charge-1/transition_density_state1.cube
  ✓ Excited state density: output_gpu_charge-1/excited_state_density_state1.cube
  ✓ Density difference: output_gpu_charge-1/density_difference_state1.cube

  ------------------------------------------------------------------
  QUANTITATIVE VERIFICATION: S1 vs HOMO→LUMO
  ------------------------------------------------------------------
  Similarity (cosine): 0.9962
  HOMO→LUMO weight: 0.9899 (99.0%)
  HOMO→LUMO amplitude: 0.9028
  ✓ S1 is STRONGLY dominated by HOMO→LUMO transition
  ------------------------------------------------------------------

State 2: 6.930 eV
  ✓ Transition density: output_gpu_charge-1/transition_density_state2.cube
  ✓ Excited state density: output_gpu_charge-1/excited_state_density_state2.cube
  ✓ Density difference: output_gpu_charge-1/density_difference_state2.cube

State 3: 7.934 eV
  ✓ Transition density: output_gpu_charge-1/transition_density_state3.cube
  ✓ Excited state density: output_gpu_charge-1/excited_state_density_state3.cube
  ✓ Density difference: output_gpu_charge-1/density_difference_state3.cube
======================================================================

======================================================================
GENERATING ORBITAL PAIR TRANSITION DENSITY CUBE FILES
======================================================================

State 1 (2.8219 eV):
Traceback (most recent call last):
  File "/home/indranil/Documents/Secondment/test/PTCDA/anion_cal/tdm_calc_accurate_GPU.py", line 1383, in <module>
    t_dm_pair = calculate_pair_transition_density(mf, occ_idx, vir_idx)
  File "/home/indranil/Documents/Secondment/test/PTCDA/anion_cal/tdm_calc_accurate_GPU.py", line 900, in calculate_pair_transition_density
    nao, nmo = mo_coeff_alpha.shape
ValueError: too many values to unpack (expected 2)
